<!DOCTYPE html>
<html>
<head>
  <title>Appbulance - Panel</title>
  <%- include ../partials/template/header -%>
</head>
<body class="fixed-nav sticky-footer <%=style.body_style%>" id="page-top">
  <%- include ../partials/template/crum-navbar -%>
  <div class="content-wrapper">
    <div class="container-fluid">
      <main>
        <!-- Breadcrumbs-->
        <%- include ../partials/template/breadcrumb -%>     
        <section id="ViewUsers">
          <!-- Example DataTables Card-->
          <div class="card mb-3">
            <div class="card-header">
              <i class="fa fa-truck"></i> Unidades Médicas
            </div>
            <div class="card-body">
              <!-- Toolbar -->
              <a class="btn btn-primary btn-success" data-toggle="modal" data-target="#addModal" style="color: #FFFFFF">Registrar</a>
              <input id="btnEliminar" type="button" class="btn btn-primary btn-danger" style="color: #FFFFFF" data-toggle="modal" data-target="#deleteModal" value="Eliminar" disabled="true">
              <input id="btnModificar" type="button" class="btn btn-primary btn-warning" style="color: #FFFFFF" data-toggle="modal" data-target="#modModal" value="Modificar" disabled="true">
              <hr>
              <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                  <thead>
                    <tr>
                      <th>ID Ambulancia</th>
                      <th>Matrícula</th>
                      <th>Número Económico</th>
                      <th>Estado</th>
                      <th>Operaciones</th>
                    </tr>
                  </thead>
                  <tfoot>
                    <tr>
                      <th>ID Ambulancia</th>
                      <th>Matrícula</th>
                      <th>Número Económico</th>
                      <th>Estado</th>
                      <th>Operaciones</th>
                    </tr>
                  </tfoot>
                  <tbody id="unitsTable">
                    <tr id="selected" onclick="toolbarAdmon()">
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>   
                      <td></td>                  
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="card-footer small text-muted">Última actualización: 15/04/2018 11:59 PM
            </div>
            <div id="contenedorForm">
            </div>
          </div>
        </section>
        <!-- Add User Modal-->    
        <%- include ../partials/modals/addUnit -%>
        <!-- Logout Modal-->
        <%- include ../partials/modals/dropUnit -%>
        <!-- Modify User Modal-->    
        <%- include ../partials/modals/modifyUnit -%>
        <!-- Scripts JavaScript-->
        <script></script>
        <script src="/js/ab-toolbarAdmon.js"></script>
      </main>
    </div>
    <%- include ../partials/template/footer -%>
    <%- include ../partials/template/top-button -%>
    <%- include ../partials/modals/logout -%>
    <%- include ../partials/template/js-scripts -%>

    <script>
      function addUnit(){ 
        var _id = Math.floor((Math.random() * 100) + 1);
        var _mat = document.getElementById("InputMatricula").value;
        var _num_economic = document.getElementById("InputEconomicNumber").value;
        var _state = document.getElementById("InputState").value;
        var fila="<tr id='unit_"+ _id + "' onclick='toolbarAdmon()'><td>"+ _id
                +"</td><td>"+_mat+"</td><td>"+_num_economic+"</td><td>"+_state+"</td><td>"+ 
                  "<input id='btnModificar' onclick='modUnit(this)' type='button' class='btn btn-primary btn-warning' style='color: #FFFFFF' data-toggle='modal' data-target='#modModal' value='Modificar'> " +
                  "<input id='btnEliminar' type='button' class='btn btn-primary btn-danger' style='color: #FFFFFF' data-toggle='modal' data-target='#deleteModal' value='Eliminar'>"
                  +"</td></tr>";
        
        if(_mat.trim()=='' || _num_economic.trim()=='' || _state.trim()==''){
          alert("Operación fracasada. Ingrese los datos faltantes.");          
        } else {
          clear();
          document.getElementById("unitsTable").innerHTML = fila;          
        }          
      }

      function clear(){
        document.getElementById("InputMatricula").value = "";
        document.getElementById("InputEconomicNumber").value = "";
        document.getElementById("InputState").value = "";
        document.getElementById("OutputIDUnit_modal").value = "";
        document.getElementById("OutputMatricula_modal").value = "";
        document.getElementById("OutputEconomicNumber_modal").value = "";
        document.getElementById("OutputState_modal").value = "";        
      }

      var editando=false;
      function modUnit(nodo){
        if (editando == false) {
          var nodoTd = nodo.parentNode;
          var nodoTr = nodoTd.parentNode;
          var nodosEnTr = nodoTr.getElementsByTagName('td');
          var _id = nodosEnTr[0].textContent; 
          var _matricula = nodosEnTr[1].textContent;
          var _num_e = nodosEnTr[2].textContent; 
          var _estado = nodosEnTr[3].textContent;
          var opciones = nodosEnTr[4].textContent;

          var _modal = "<div class='form-group'>"+
                          " <label for='OutputIDUnit'>ID Ambulancia</label>"+
                          "<input class='form-control' id='OutputIDUnit_modal' type='text' value='"+ _id +"' disabled>"+
                        "</div> "+
                        "<div class='form-group'>"+
                          "<label for='OutputMatricula'>Matrícula</label>"+
                          "<input class='form-control' id='OutputMatricula_modal' type='text' value='"+ _matricula +"'>"+
                        "</div>"+
                        "<div class='form-group'>"+
                          "<label for='OutputEconomicNumber'>Número Económico</label>"+
                          "<input class='form-control' id='OutputEconomicNumber_modal' type='text' value='"+ _num_e +"'>"+
                        "</div>"+   
                        "<div class='form-group'>"+
                          "<label for='OutputState'>Estado</label>"+
                          "<input class='form-control' id='OutputState_modal' type='text' value='"+ _estado +"'>"+
                        "</div>";
          document.getElementById('modal-modUnits').innerHTML = _modal;
        }else {
          alert ('Solo se puede editar un registro a la vez. Recargue la página para poder editar otra.');
        }
      } 

      function confirmModUnit(){ //Este metodo puede ser reemplazado sencillamente ejecutando la consulta de UPDATE y 
        var _id = document.getElementById("OutputIDUnit_modal").value;
        var _mat = document.getElementById("OutputMatricula_modal").value;
        var _num_economic = document.getElementById("OutputEconomicNumber_modal").value;
        var _state = document.getElementById("OutputState_modal").value;

        var fila="<tr id='unit_"+ _id + "' onclick='toolbarAdmon()'><td>"+ _id
                +"</td><td>"+_mat+"</td><td>"+_num_economic+"</td><td>"+_state+"</td><td>"+ 
                  "<input id='btnModificar' onclick='modUnit(this)' type='button' class='btn btn-primary btn-warning' style='color: #FFFFFF' data-toggle='modal' data-target='#modModal' value='Modificar'> " +
                  "<input id='btnEliminar' type='button' class='btn btn-primary btn-danger' style='color: #FFFFFF' data-toggle='modal' data-target='#deleteModal' value='Eliminar'>"
                  +"</td></tr>";
        document.getElementById("unitsTable").innerHTML = fila; 
      }


    </script>
  </div>
</body>
</html>